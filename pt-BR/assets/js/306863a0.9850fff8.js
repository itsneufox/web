"use strict";(self.webpackChunkomp_web=self.webpackChunkomp_web||[]).push([["36438"],{85567:function(e,o,a){a.r(o),a.d(o,{frontMatter:()=>i,toc:()=>l,default:()=>u,metadata:()=>n,assets:()=>d,contentTitle:()=>t});var n=JSON.parse('{"id":"tutorials/cooldowns","title":"Tempos de Espera (Cooldowns)","description":"Um tutorial para escrever tempos de espera para limitar a\xe7\xf5es do usu\xe1rio usando contagem de ticks e evitando o uso de timers.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/tutorials/cooldowns.md","sourceDirName":"tutorials","slug":"/tutorials/cooldowns","permalink":"/pt-BR/docs/tutorials/cooldowns","draft":false,"unlisted":false,"editUrl":"https://github.com/openmultiplayer/web/edit/master/frontend/i18n/pt-BR/docusaurus-plugin-content-docs/current/tutorials/cooldowns.md","tags":[],"version":"current","frontMatter":{"title":"Tempos de Espera (Cooldowns)","sidebar_label":"Tempos de Espera (Cooldowns)","description":"Um tutorial para escrever tempos de espera para limitar a\xe7\xf5es do usu\xe1rio usando contagem de ticks e evitando o uso de timers."},"sidebar":"docsSidebar","previous":{"title":"Corre\xe7\xe3o de Cores","permalink":"/pt-BR/docs/tutorials/colorfix"},"next":{"title":"Sistema de vari\xe1veis do servidor","permalink":"/pt-BR/docs/tutorials/servervariablesystem"}}'),s=a(85893),r=a(50065);let i={title:"Tempos de Espera (Cooldowns)",sidebar_label:"Tempos de Espera (Cooldowns)",description:"Um tutorial para escrever tempos de espera para limitar a\xe7\xf5es do usu\xe1rio usando contagem de ticks e evitando o uso de timers."},t=void 0,d={},l=[{value:"Usando Timers",id:"usando-timers",level:2},{value:"Usando <code>GetTickCount()</code> e <code>gettime()</code>",id:"usando-gettickcount-e-gettime",level:2},{value:"Um Cooldown",id:"um-cooldown",level:3},{value:"Um Cron\xf4metro",id:"um-cron\xf4metro",level:3},{value:"Detalhamento",id:"detalhamento",level:4},{value:"Recapitula\xe7\xe3o e Notas",id:"recapitula\xe7\xe3o-e-notas",level:2}];function c(e){let o={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.p,{children:"Este tutorial aborda a escrita de uma mec\xe2nica de gameplay comumente usada em jogos de a\xe7\xe3o: tempos de espera (cooldowns). Um cooldown \xe9 uma ferramenta para limitar a frequ\xeancia com que um jogador pode fazer algo. Isso pode ser algo como usar uma habilidade, como cura, ou escrever mensagens no chat. Ele permite que voc\xea diminua a taxa com que os jogadores fazem coisas, seja para fins de balanceamento de gameplay ou para prevenir spam."}),"\n",(0,s.jsxs)(o.p,{children:["Primeiro, vou exemplificar a forma ",(0,s.jsx)(o.em,{children:"ruim"})," de fazer um cooldown usando ",(0,s.jsx)(o.code,{children:"SetTimer"})," para atualizar o estado."]}),"\n",(0,s.jsx)(o.h2,{id:"usando-timers",children:"Usando Timers"}),"\n",(0,s.jsx)(o.p,{children:"Digamos, por exemplo, que voc\xea tenha uma a\xe7\xe3o espec\xedfica que s\xf3 pode ser executada uma vez a cada tantos segundos. Eu vejo muitas pessoas (incluindo Southclaws, muitos anos atr\xe1s) fazendo algo assim:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'static bool:IsPlayerAllowedToDoThing[MAX_PLAYERS];\n\nOnPlayerInteractWithServer(playerid)\n/* Isso pode ser qualquer tipo de evento de entrada que um jogador faz, como:\n *  Inserir um comando\n *  Pegar um pickup\n *  Entrar em um checkpoint\n *  Pressionar um bot\xe3o\n *  Entrar em uma \xe1rea\n *  Usar um di\xe1logo\n */\n{\n    // Isso s\xf3 funciona quando o jogador tem permiss\xe3o\n    if (IsPlayerAllowedToDoThing[playerid])\n    {\n        // Faz o que o jogador solicitou\n        DoTheThingThePlayerRequested();\n\n        // Remove a permiss\xe3o do jogador\n        IsPlayerAllowedToDoThing[playerid] = false;\n\n        // Permite que o jogador fa\xe7a a coisa novamente em 10 segundos\n        SetTimerEx("AllowPlayer", 10000, false, "d", playerid);\n\n        return 1;\n    }\n    else\n    {\n        SendClientMessage(playerid, -1, "Voc\xea ainda n\xe3o pode fazer isso!");\n\n        return 0;\n    }\n}\n\n// Chamado 10 segundos ap\xf3s o jogador fazer a coisa\npublic AllowPlayer(playerid)\n{\n    IsPlayerAllowedToDoThing[playerid] = true;\n    SendClientMessage(playerid, -1, "Voc\xea pode fazer a coisa novamente! :D");\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"Isso est\xe1 tudo bem, funciona, o jogador n\xe3o poder\xe1 fazer aquela coisa novamente por 10 segundos ap\xf3s us\xe1-la."}),"\n",(0,s.jsx)(o.p,{children:"Veja outro exemplo aqui, este \xe9 um cron\xf4metro que mede quanto tempo leva para um jogador fazer uma corrida simples de ponto a ponto:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'static\n    StopWatchTimerID[MAX_PLAYERS],\n    StopWatchTotalTime[MAX_PLAYERS];\n\nStartPlayerRace(playerid)\n{\n    // Chama uma fun\xe7\xe3o a cada segundo\n    StopWatchTimerID[playerid] = SetTimerEx("StopWatch", 1000, true, "d", playerid);\n}\n\npublic StopWatch(playerid)\n{\n    // Incrementa o contador de segundos\n    StopWatchTotalTime[playerid]++;\n}\n\nOnPlayerFinishRace(playerid)\n{\n    new str[128];\n\n    format(str, 128, "Voc\xea levou %d segundos para fazer isso", StopWatchTotalTime[playerid]);\n    SendClientMessage(playerid, -1, str);\n\n    KillTimer(StopWatchTimerID[playerid]);\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"Esses dois exemplos s\xe3o comuns e funcionam bem. No entanto, h\xe1 uma forma muito melhor de alcan\xe7ar ambos os resultados, que \xe9 muito mais precisa e pode dar tempos de cron\xf4metro at\xe9 o milissegundo!"}),"\n",(0,s.jsxs)(o.h2,{id:"usando-gettickcount-e-gettime",children:["Usando ",(0,s.jsx)(o.code,{children:"GetTickCount()"})," e ",(0,s.jsx)(o.code,{children:"gettime()"})]}),"\n",(0,s.jsxs)(o.p,{children:[(0,s.jsx)(o.code,{children:"GetTickCount()"})," \xe9 uma fun\xe7\xe3o que retorna o tempo em milissegundos desde que o processo do servidor foi aberto. ",(0,s.jsx)(o.code,{children:"gettime()"})," retorna o n\xfamero de segundos desde 1\xba de janeiro de 1970, tamb\xe9m conhecido como Timestamp Unix."]}),"\n",(0,s.jsx)(o.p,{children:"Se voc\xea chamar qualquer uma dessas fun\xe7\xf5es em dois momentos diferentes e subtrair o primeiro tempo do segundo, de repente voc\xea tem um intervalo entre esses dois eventos em milissegundos ou segundos respectivamente! Veja este exemplo:"}),"\n",(0,s.jsx)(o.h3,{id:"um-cooldown",children:"Um Cooldown"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'static PlayerAllowedTick[MAX_PLAYERS];\n\nOnPlayerInteractWithServer(playerid)\n{\n   if (GetTickCount() - PlayerAllowedTick[playerid] > 10000)\n   // Isso s\xf3 funciona quando o tick atual menos o \xfaltimo tick \xe9 superior a 10000.\n   // Em outras palavras, s\xf3 funciona quando o intervalo entre as a\xe7\xf5es \xe9 superior a 10 segundos.\n   {\n       DoTheThingThePlayerRequested();\n       PlayerAllowedTick[playerid] = GetTickCount(); // Atualiza a contagem de ticks com o tempo mais recente.\n\n       return 1;\n   }\n   else\n   {\n       SendClientMessage(playerid, -1, "Voc\xea ainda n\xe3o pode fazer isso!");\n\n       return 0;\n   }\n}\n'})}),"\n",(0,s.jsxs)(o.p,{children:["Ou, alternativamente, a vers\xe3o com ",(0,s.jsx)(o.code,{children:"gettime()"}),":"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'static PlayerAllowedSeconds[MAX_PLAYERS];\n\nOnPlayerInteractWithServer(playerid)\n{\n   if (gettime() - PlayerAllowedSeconds[playerid] > 10)\n   // Isso s\xf3 funciona quando os segundos atuais menos os \xfaltimos segundos \xe9 superior a 10.\n   // Em outras palavras, s\xf3 funciona quando o intervalo entre as a\xe7\xf5es \xe9 superior a 10 segundos.\n   {\n       DoTheThingThePlayerRequested();\n       PlayerAllowedSeconds[playerid] = gettime(); // Atualiza a contagem de segundos com o tempo mais recente.\n\n       return 1;\n   }\n   else\n   {\n       SendClientMessage(playerid, -1, "Voc\xea ainda n\xe3o pode fazer isso!");\n\n       return 0;\n   }\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"H\xe1 muito menos c\xf3digo ali, sem necessidade de uma fun\xe7\xe3o p\xfablica ou um timer. Se voc\xea realmente quiser, pode colocar o tempo restante na mensagem de erro:"}),"\n",(0,s.jsx)(o.p,{children:"(Estou usando SendFormatMessage neste exemplo)"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'SendFormatMessage(\n    playerid,\n    -1,\n    "Voc\xea ainda n\xe3o pode fazer isso! Pode novamente em %d ms",\n    10000 - (GetTickCount() - PlayerAllowedTick[playerid])\n);\n'})}),"\n",(0,s.jsxs)(o.p,{children:["Esse \xe9 um exemplo muito b\xe1sico, seria melhor converter esse valor em MS para uma string de ",(0,s.jsx)(o.code,{children:"minutos:segundos.milissegundos"}),", mas vou postar esse c\xf3digo no final."]}),"\n",(0,s.jsx)(o.h3,{id:"um-cron\xf4metro",children:"Um Cron\xf4metro"}),"\n",(0,s.jsx)(o.p,{children:"Espero que voc\xea consiga ver como isso \xe9 poderoso para obter intervalos entre eventos, vamos olhar outro exemplo"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'static Stopwatch[MAX_PLAYERS];\n\nStartPlayerRace(playerid)\n{\n    Stopwatch[playerid] = GetTickCount();\n}\n\nOnPlayerFinishRace(playerid)\n{\n    new\n        interval,\n        str[128];\n\n    interval = GetTickCount() - Stopwatch[playerid];\n\n    format(str, 128, "Voc\xea levou %d milissegundos para fazer isso", interval);\n    SendClientMessage(playerid, -1, str);\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"Neste exemplo, a contagem de ticks \xe9 salva na vari\xe1vel do jogador quando ele inicia a corrida. Quando ele termina, o tick atual (de quando ele terminou) tem aquele tick inicial (o valor menor) subtra\xeddo dele e assim nos deixa com a quantidade de milissegundos entre o in\xedcio e o fim da corrida."}),"\n",(0,s.jsx)(o.h4,{id:"detalhamento",children:"Detalhamento"}),"\n",(0,s.jsx)(o.p,{children:"Agora vamos detalhar o c\xf3digo um pouco."}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:"new Stopwatch[MAX_PLAYERS];\n"})}),"\n",(0,s.jsx)(o.p,{children:"Esta \xe9 uma vari\xe1vel global, precisamos us\xe1-la para poder salvar a contagem de ticks e recuperar o valor em outro momento (em outras palavras, us\xe1-la em outra fun\xe7\xe3o, posteriormente)"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:"StartPlayerRace(playerid)\n{\n    Stopwatch[playerid] = GetTickCount();\n}\n"})}),"\n",(0,s.jsx)(o.p,{children:"Isso \xe9 quando o jogador inicia a corrida, a contagem de ticks do momento \xe9 registrada. Se isso acontecer 1 minuto ap\xf3s o servidor iniciar, o valor dessa vari\xe1vel ser\xe1 60.000 porque s\xe3o 60 segundos e cada segundo tem mil milissegundos."}),"\n",(0,s.jsx)(o.p,{children:"Ok, agora temos a vari\xe1vel desse jogador definida em 60.000, agora ele termina a corrida 1 minuto e 40 segundos depois:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-pawn",children:'OnPlayerFinishRace(playerid)\n{\n    new\n        interval,\n        str[128];\n\n    interval = GetTickCount() - Stopwatch[playerid];\n\n    format(str, 128, "Voc\xea levou %d milissegundos para fazer isso", interval);\n    SendClientMessage(playerid, -1, str);\n}\n'})}),"\n",(0,s.jsx)(o.p,{children:"Aqui \xe9 onde o c\xe1lculo do intervalo acontece, bom, eu digo c\xe1lculo, mas \xe9 apenas subtrair dois valores!"}),"\n",(0,s.jsx)(o.p,{children:"GetTickCount() retorna a contagem de ticks atual, ent\xe3o ser\xe1 maior que a contagem de ticks inicial, o que significa que voc\xea subtrai a contagem de ticks inicial da contagem de ticks atual para obter seu intervalo entre as duas medidas."}),"\n",(0,s.jsx)(o.p,{children:"Ent\xe3o, como dissemos, o jogador termina a corrida 1 minuto e 40 segundos depois (100 segundos, ou 100.000 milissegundos), GetTickCount retornar\xe1 160.000. Subtraia o valor inicial (que \xe9 60.000) do novo valor (que \xe9 160.000) e voc\xea obt\xe9m 100.000 milissegundos, que \xe9 1 minuto e 40 segundos, que \xe9 o tempo que o jogador levou para fazer a corrida!"}),"\n",(0,s.jsx)(o.h2,{id:"recapitula\xe7\xe3o-e-notas",children:"Recapitula\xe7\xe3o e Notas"}),"\n",(0,s.jsx)(o.p,{children:"Ent\xe3o! Aprendemos que:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"GetTickCount retorna a quantidade de tempo em milissegundos desde que o sistema de computador em que o servidor est\xe1 rodando foi iniciado."}),"\n",(0,s.jsx)(o.li,{children:"E podemos usar isso chamando-o em dois intervalos, salvando o primeiro em uma vari\xe1vel e comparando os dois valores, podemos obter um intervalo preciso em milissegundos entre esses dois eventos."}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"Por \xfaltimo, voc\xea n\xe3o quer ficar dizendo aos seus jogadores valores de tempo em milissegundos! E se eles levarem uma hora para completar uma corrida?"}),"\n",(0,s.jsx)(o.p,{children:"\xc9 melhor usar uma fun\xe7\xe3o que recebe os milissegundos e os converte em um formato leg\xedvel, por exemplo, no exemplo anterior o jogador levou 100.000 milissegundos para fazer a corrida, se voc\xea dissesse ao jogador que ele levou tanto tempo, levaria mais tempo para ler aqueles 100.000 e descobrir o que significa em tempo leg\xedvel para humanos."}),"\n",(0,s.jsxs)(o.p,{children:[(0,s.jsx)(o.a,{href:"https://github.com/ScavengeSurvive/timeutil",children:"Este pacote"})," cont\xe9m uma fun\xe7\xe3o para formatar milissegundos em uma string."]}),"\n",(0,s.jsxs)(o.p,{children:["Espero que isso tenha ajudado! Eu escrevi porque ajudei algumas pessoas recentemente que n\xe3o sabiam como usar ",(0,s.jsx)(o.code,{children:"GetTickCount()"})," ou ",(0,s.jsx)(o.code,{children:"gettime()"})," como alternativa para timers ou para obter intervalos etc."]})]})}function u(e={}){let{wrapper:o}={...(0,r.a)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},50065:function(e,o,a){a.d(o,{Z:()=>t,a:()=>i});var n=a(67294);let s={},r=n.createContext(s);function i(e){let o=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(r.Provider,{value:o},e.children)}}}]);